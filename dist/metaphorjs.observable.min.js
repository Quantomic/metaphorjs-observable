'use strict';(function(){function n(c){return"object"==typeof c&&3===s(c)&&!c.nodeType&&c.constructor===Object}function q(c){return!0===c||!1===c}var t=Function.prototype.bind?function(c,a){return c.bind(a)}:function(c,a){return function(){return c.apply(a,arguments)}},l=Array.prototype.slice,u=Object.prototype.toString,s=function(){var c={"[object String]":0,"[object Number]":1,"[object Boolean]":2,"[object Object]":3,"[object Function]":4,"[object Array]":5,"[object RegExp]":9,"[object Date]":10};
return function(a){if(!a){if(null===a)return 6;if(void 0===a)return 7}var b=c[u.call(a)];return void 0===b?-1:1==b&&isNaN(a)?8:b}}(),m=function(){return function a(){var b=!1,d=!1,f=l.call(arguments),e=f.shift(),k,g,h;q(f[f.length-1])&&(b=f.pop());q(f[f.length-1])&&(d=b,b=f.pop());for(;f.length;)if(k=f.shift())for(g in k)if(k.hasOwnProperty(g)&&void 0!==(h=k[g]))if(d)if(e[g]&&n(e[g])&&n(h))a(e[g],h,b,d);else{if(!0===b||void 0==e[g])n(h)?(e[g]={},a(e[g],h,b,!0)):e[g]=h}else if(!0===b||void 0==e[g])e[g]=
h;return e}}(),v=function(){var c=["0","0","0"];return function(){for(var a=c.length,b;a;){a--;b=c[a].charCodeAt(0);if(57==b)return c[a]="A",c.join("");if(90==b)c[a]="0";else return c[a]=String.fromCharCode(b+1),c.join("")}c.unshift("0");return c.join("")}}(),r=function(){var c=function(a,b,d,f,e){this.name=a;this.listeners=[];this.map={};this.hash=v();this.uni="$$"+a+"_"+this.hash;this.suspended=!1;this.lid=0;"object"==typeof b&&null!==b?m(this,b,!0,!1):(this.returnResult=void 0===b?null:b,this.autoTrigger=
d,this.triggerFilter=f,this.filterContext=e)};m(c.prototype,{name:null,listeners:null,map:null,hash:null,uni:null,suspended:!1,lid:null,returnResult:null,autoTrigger:null,lastTrigger:null,triggerFilter:null,filterContext:null,getName:function(){return this.name},destroy:function(){for(var a in this)this[a]=null},on:function(a,b,d){if(!a)return null;b=b||null;d=d||{};var f=this.uni,e=b||a;if(e[f]&&!d.allowDupes)return null;var c=++this.lid,g=d.first||!1;e[f]=c;a={fn:a,context:b,uniContext:e,id:c,called:0,
limit:0,start:1,count:0,append:null,prepend:null};m(a,d,!0,!1);g?this.listeners.unshift(a):this.listeners.push(a);this.map[c]=a;if(this.autoTrigger&&this.lastTrigger&&!this.suspended){var h=this.triggerFilter;this.triggerFilter=function(a){return a.id==c?h?!1!==h(a):!0:!1};this.trigger.apply(this,this.lastTrigger);this.triggerFilter=h}return c},once:function(a,b,d){d=d||{};d.limit=1;return this.on(a,b,d)},un:function(a,b){var d=-1,f=this.uni,e=this.listeners,c;c=a==parseInt(a)?a:(b||a)[f];if(!c)return!1;
for(var g=0,h=e.length;g<h;g++)if(e[g].id==c){d=g;delete e[g].uniContext[f];break}if(-1==d)return!1;e.splice(d,1);delete this.map[c];return!0},hasListener:function(a,b){var d=this.listeners,f;if(a){f="function"!=typeof a?a:(b||a)[this.uni];if(!f)return!1;for(var e=0,c=d.length;e<c;e++)if(d[e].id==f)return!0;return!1}return 0<d.length},removeAllListeners:function(){var a=this.listeners,b=this.uni,d,f;d=0;for(f=a.length;d<f;d++)delete a[d].uniContext[b];this.listeners=[];this.map={}},suspend:function(){this.suspended=
!0},resume:function(){this.suspended=!1},_prepareArgs:function(a,b){var d;a.append||a.prepend?(d=l.call(b),a.prepend&&(d=a.prepend.concat(d)),a.append&&(d=d.concat(a.append))):d=b;return d},trigger:function(){var a=this.listeners,b=this.returnResult,d=this.triggerFilter,f=this.filterContext,e;if(this.suspended)return null;this.autoTrigger&&(this.lastTrigger=l.call(arguments));if(0==a.length)return null;for(var c="all"==b||"merge"==b?[]:null,g,a="first"==b?[a[0]]:l.call(a);g=a.shift();)if(g&&this.map[g.id]&&
(e=this._prepareArgs(g,arguments),!d||!1!==d.call(f,g,e,this))&&(g.count++,!(g.count<g.start)))if(e=g.fn.apply(g.context,e),g.called++,g.called==g.limit&&this.un(g.id),"all"==b)c.push(e);else if("merge"==b&&e)c=c.concat(e);else{if("first"==b||"nonempty"==b&&e)return e;if("last"==b)c=e;else if(!1==b&&!1===e)return!1}if(b)return c}},!0,!1);return c}(),w=function(){var c=function(){this.events={}};m(c.prototype,{createEvent:function(a,b,d,c,e){a=a.toLowerCase();var k=this.events;k[a]||(k[a]=new r(a,
b,d,c,e));return k[a]},getEvent:function(a){a=a.toLowerCase();return this.events[a]},on:function(a,b,d,c){a=a.toLowerCase();var e=this.events;e[a]||(e[a]=new r(a));return e[a].on(b,d,c)},once:function(a,b,d,c){c=c||{};c.limit=1;return this.on(a,b,d,c)},un:function(a,b,c){a=a.toLowerCase();var f=this.events;f[a]&&f[a].un(b,c)},hasListener:function(a,b,c){var f=this.events;if(a)return a=a.toLowerCase(),f[a]?f[a].hasListener(b,c):!1;for(a in f)if(f[a].hasListener())return!0;return!1},removeAllListeners:function(a){var b=
this.events;b[a]&&b[a].removeAllListeners()},trigger:function(){var a=arguments[0],b=this.events,a=a.toLowerCase();if(!b[a])return null;a=b[a];return a.trigger.apply(a,l.call(arguments,1))},suspendEvent:function(a){a=a.toLowerCase();var b=this.events;b[a]&&b[a].suspend()},suspendAllEvents:function(){var a=this.events,b;for(b in a)a[b].suspend()},resumeEvent:function(a){a=a.toLowerCase();var b=this.events;b[a]&&b[a].resume()},resumeAllEvents:function(){var a=this.events,b;for(b in a)a[b].resume()},
destroyEvent:function(a){var b=this.events;b[a]&&(b[a].removeAllListeners(),b[a].destroy(),delete b[a])},destroy:function(){var a=this.events,b;for(b in a)this.destroyEvent(b);for(b in this)this[b]=null},getApi:function(){if(!this.api){for(var a="createEvent getEvent on un once hasListener removeAllListeners trigger suspendEvent suspendAllEvents resumeEvent resumeAllEvents destroyEvent".split(" "),b={},c,f=-1,e=a.length;++f<e;c=a[f],b[c]=t(this[c],this));this.api=b}return this.api}},!0,!1);return c}(),
p={};p.Observable=w;"undefined"!=typeof global?global.MetaphorJs=p:window.MetaphorJs=p})();
