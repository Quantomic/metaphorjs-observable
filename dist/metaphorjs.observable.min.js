(function(){window.MetaphorJs={lib:{}};var q=MetaphorJs.isThenable=function(g){var e;return!g||"object"!=typeof g&&"function"!=typeof g?!1:"function"==typeof(e=g.then)?e:!1},l=MetaphorJs.bind=Function.prototype.bind?function(g,e){return g.bind(e)}:function(g,e){return function(){return g.apply(e,arguments)}};(function(){var g=[],e=!1,h="undefined"!=typeof process?process.nextTick:function(d){setTimeout(d,0)},n=function(){e=!0;var d=g.shift();h(function(){d[0].apply(d[1],d[2]);g.length?n():e=!1},0)},
a=function(d,a,b){b=b||[];g.push([d,a,b]);e||n()},b=function(d,a){return function(b){try{a.resolve(d(b))}catch(c){a.reject(c)}}},c=function(a,k){if(a instanceof c)return a;if(!(this instanceof c))return new c(a,k);this._fulfills=[];this._rejects=[];this._dones=[];this._fails=[];if("undefined"!=typeof a)if(q(a)||"function"!=typeof a)this.resolve(a);else try{a.call(k,l(this.resolve,this),l(this.reject,this))}catch(b){this.reject(b)}};c.prototype={_state:0,_fulfills:null,_rejects:null,_dones:null,_fails:null,
_wait:0,_value:null,_reason:null,_triggered:!1,isPending:function(){return 0==this._state},isFulfilled:function(){return 1==this._state},isRejected:function(){return 2==this._state},_cleanup:function(){delete this._fulfills;delete this._rejects;delete this._dones;delete this._fails},_processValue:function(a,b){var f;if(0==this._state)if(a===this)this._doReject(new TypeError("cannot resolve promise with itself"));else{try{if(f=q(a)){a instanceof c?a.then(l(this._processResolveValue,this),l(this._processRejectReason,
this)):(new c(f,a)).then(l(this._processResolveValue,this),l(this._processRejectReason,this));return}}catch(p){0==this._state&&this._doReject(p);return}b.call(this,a)}},_callResolveHandlers:function(){this._done();for(var d=this._fulfills,b;b=d.shift();)a(b[0],b[1],[this._value]);this._cleanup()},_doResolve:function(a){this._value=a;this._state=1;0==this._wait&&this._callResolveHandlers()},_processResolveValue:function(a){this._processValue(a,this._doResolve)},resolve:function(a){if(this._triggered)return this;
this._triggered=!0;this._processResolveValue(a);return this},_callRejectHandlers:function(){this._fail();for(var d=this._rejects,b;b=d.shift();)a(b[0],b[1],[this._reason]);this._cleanup()},_doReject:function(a){this._state=2;this._reason=a;0==this._wait&&this._callRejectHandlers()},_processRejectReason:function(a){this._processValue(a,this._doReject)},reject:function(a){if(this._triggered)return this;this._triggered=!0;this._processRejectReason(a);return this},then:function(d,k){var f=new c,p=this._state;
0==p||0!=this._wait?(d&&"function"==typeof d?this._fulfills.push([b(d,f),null]):this._fulfills.push([f.resolve,f]),k&&"function"==typeof k?this._rejects.push([b(k,f),null]):this._rejects.push([f.reject,f])):1==p?d&&"function"==typeof d?a(b(d,f),null,[this._value]):f.resolve(this._value):2==p&&(k&&"function"==typeof k?a(b(k,f),null,[this._reason]):f.reject(this._reason));return f},"catch":function(a){return this.then(null,a)},_done:function(){for(var a=this._dones,b;b=a.shift();)b[0].call(b[1]||null,
this._value)},done:function(a,b){var c=this._state;1==c&&0==this._wait?a.call(b||null,this._value):0==c&&this._dones.push([a,b]);return this},_fail:function(){for(var a=this._fails,b;b=a.shift();)b[0].call(b[1]||null,this._reason)},fail:function(a,b){var c=this._state;2==c&&0==this._wait?a.call(b||null,this._reason):0==c&&this._fails.push([a,b]);return this},always:function(a,b){this.done(a,b);this.fail(a,b);return this},promise:function(){return{then:l(this.then,this),done:l(this.done,this),fail:l(this.fail,
this),always:l(this.always,this)}},after:function(a){var b=this;if(q(a)){b._wait++;var c=function(){b._wait--;0==b._wait&&0!=b._state&&(1==b._state?b._callResolveHandlers():b._callRejectHandlers())};"function"==typeof a.done?a.done(c):a.then(c)}return b}};c.resolve=function(a){return new c(a)};c.reject=function(a){var b=new c;b.reject(a);return b};c.all=function(a){if(!a.length)return c.resolve(null);var b=new c,f=a.length,p=Array(f),e=f,g,m,h=function(a,c){p[c]=a;e--;0==e&&b.resolve(p)};for(g=0;g<
f;g++)(function(f){m=a[g];m instanceof c?m.done(function(a){h(a,f)}).fail(b.reject,b):q(m)||"function"==typeof m?(new c(m)).done(function(a){h(a,f)}).fail(b.reject,b):h(m,f)})(g);return b};c.when=function(){return c.all(arguments)};c.allResolved=function(a){if(!a.length)return c.resolve(null);var b=new c,f=a.length,g=[],e=f,h,m,l=function(a){g.push(a);n()},n=function(){e--;0==e&&b.resolve(g)};for(h=0;h<f;h++)m=a[h],m instanceof c?m.done(l).fail(n):q(m)||"function"==typeof m?(new c(m)).done(l).fail(n):
l(m);return b};c.race=function(a){if(!a.length)return c.resolve(null);var b=new c,f=a.length,g,e;for(g=0;g<f&&(e=a[g],e instanceof c?e.done(b.resolve,b).fail(b.reject,b):q(e)||"function"==typeof e?(new c(e)).done(b.resolve,b).fail(b.reject,b):b.resolve(e),b.isPending());g++);return b};MetaphorJs.lib.Promise=c})();var s=MetaphorJs.lib.Promise,u=MetaphorJs.nextUid=function(){var g=["0","0","0"];return function(){for(var e=g.length,h;e;){e--;h=g[e].charCodeAt(0);if(57==h)return g[e]="A",g.join("");if(90==
h)g[e]="0";else return g[e]=String.fromCharCode(h+1),g.join("")}g.unshift("0");return g.join("")}}(),r=Array.prototype.slice,t=MetaphorJs.isPlainObject=function(g){return!(!g||g.constructor!==Object)},v=MetaphorJs.extend=function e(){var h=!1,l=!1,a=r.call(arguments),b=a.shift(),c,d,k;"boolean"==typeof a[a.length-1]&&(h=a.pop());"boolean"==typeof a[a.length-1]&&(l=h,h=a.pop());for(;a.length;)if(c=a.shift())for(d in c)if(c.hasOwnProperty(d)&&"undefined"!=typeof(k=c[d]))if(l)if(b[d]&&t(b[d])&&t(k))e(b[d],
k,h,l);else{if(!0===h||"undefined"==typeof b[d]||null===b[d])t(k)?(b[d]={},e(b[d],k,h,!0)):b[d]=k}else if(!0===h||"undefined"==typeof b[d]||null===b[d])b[d]=k;return b},w=MetaphorJs.async=function(e,h,l){setTimeout(function(){e.apply(h,l||[])},0)};(function(){var e=function(){this.events={}};e.prototype={createEvent:function(a,b){a=a.toLowerCase();var c=this.events;c[a]||(c[a]=new h(a,b));return c[a]},getEvent:function(a){a=a.toLowerCase();return this.events[a]},on:function(a,b,c,d){a=a.toLowerCase();
var k=this.events;k[a]||(k[a]=new h(a));return k[a].on(b,c,d)},once:function(a,b,c,d){d=d||{};d.limit=1;return this.on(a,b,c,d)},un:function(a,b,c){a=a.toLowerCase();var d=this.events;d[a]&&d[a].un(b,c)},hasListener:function(a,b,c){a=a.toLowerCase();var d=this.events;return d[a]?d[a].hasListener(b,c):!1},removeAllListeners:function(a){var b=this.events;b[a]&&b[a].removeAllListeners()},triggerAsync:function(){var a=arguments[0],b=this.events,a=a.toLowerCase();if(!b[a])return[];a=b[a];return a.triggerAsync.apply(a,
r.call(arguments,1))},trigger:function(){var a=arguments[0],b=this.events,a=a.toLowerCase();if(!b[a])return null;a=b[a];return a.trigger.apply(a,r.call(arguments,1))},suspendEvent:function(a){a=a.toLowerCase();var b=this.events;b[a]&&b[a].suspend()},suspendAllEvents:function(){var a=this.events,b;for(b in a)a[b].suspend()},resumeEvent:function(a){a=a.toLowerCase();var b=this.events;b[a]&&b[a].resume()},resumeAllEvents:function(){var a=this.events,b;for(b in a)a[b].resume()},destroyEvent:function(a){var b=
this.events;b[a]&&(b[a].removeAllListeners(),b[a].destroy(),delete b[a])},destroy:function(a){var b=this.events;if(a)a=a.toLowerCase(),b[a]&&(b[a].destroy(),delete b[a]);else{for(var c in b)b[c].destroy();this.events={}}},getApi:function(){if(!this.api){for(var a="createEvent getEvent on un once hasListener removeAllListeners triggerAsync trigger suspendEvent suspendAllEvents resumeEvent resumeAllEvents destroyEvent".split(" "),b={},c,d=-1,k=a.length;++d<k;c=a[d],b[c]=l(this[c],this));this.api=b}return this.api}};
var h=function(a,b){this.name=a;this.listeners=[];this.map={};this.hash=u();this.uni="$$"+a+"_"+this.hash;this.suspended=!1;this.lid=0;this.returnResult=b||!1};h.prototype={getName:function(){return this.name},destroy:function(){this.map=this.listeners=null},on:function(a,b,c){if(!a)return null;b=b||null;c=c||{};var d=this.uni,k=b||a;if(k[d]&&!c.allowDupes)return null;var f=++this.lid,e=c.first||!1;k[d]=f;a={fn:a,scope:b,uniScope:k,id:f,called:0,limit:c.limit||0,start:c.start||1,count:0,append:c.append,
prepend:c.prepend};e?this.listeners.unshift(a):this.listeners.push(a);this.map[f]=a;return f},once:function(a,b,c){c=c||{};c.once=!0;return this.on(a,b,c)},un:function(a,b){var c=-1,d=this.uni,k=this.listeners,f;f=a==parseInt(a)?a:(b||a)[d];if(!f)return!1;for(var e=0,h=k.length;e<h;e++)if(k[e].id==f){c=e;delete k[e].uniScope[d];break}if(-1==c)return!1;k.splice(c,1);delete this.map[f];return!0},hasListener:function(a,b){var c=this.listeners,d;if(a){d="function"!=typeof a?a:(b||a)[this.uni];if(!d)return!1;
for(var e=0,f=c.length;e<f;e++)if(c[e].id==d)return!0;return!1}return 0<c.length},removeAllListeners:function(){var a=this.listeners,b=this.uni,c,d;c=0;for(d=a.length;c<d;c++)delete a[c].uniScope[b];this.listeners=[];this.map={}},suspend:function(){this.suspended=!0},resume:function(){this.suspended=!1},_prepareArgs:function(a,b){var c;a.append||a.prepend?(c=r.call(b),a.prepend&&(c=a.prepend.concat(c)),a.append&&(c=c.concat(a.append))):c=b;return c},triggerAsync:function(){if("undefined"==typeof s)throw Error("Promises are not defined");
var a=this,b=a.listeners,c=a.returnResult,d=r.call(arguments),e=[],f=[],h,l,n;if(a.suspended||0==b.length)return s.resolve(null);l=0;for(n=b.length;l<n;l++)e.push(b[l]);for(l=function(b){h=a._prepareArgs(b,d);return new s(function(c,d){w(function(){try{c(b.fn.apply(b.scope,h))}catch(e){d(e)}b.called++;b.called==b.limit&&a.un(b.id)},0)})};(b=e.shift())&&(!b||!a.map[b.id]||(b.count++,b.count<b.start||(f.push(l(b)),"first"!=c))););return"last"==c?[f.pop()]:f},trigger:function(){var a=this.listeners,
b=this.returnResult;if(this.suspended||0==a.length)return null;for(var c="all"==b?[]:null,d,e,a="first"==b?[a[0]]:r.call(a);d=a.shift();)if(d&&this.map[d.id]&&(d.count++,!(d.count<d.start))){e=d.fn.apply(d.scope,this._prepareArgs(d,arguments));d.called++;d.called==d.limit&&this.un(d.id);"all"==b&&c.push(e);if("first"==b)return e;"last"==b&&(c=e);if(!1==b&&!1===e)break}if(b)return c}};var n=new e;v(MetaphorJs,n.getApi(),!0,!1);MetaphorJs.lib.Observable=e})()})();
